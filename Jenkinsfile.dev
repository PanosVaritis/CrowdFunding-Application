pipeline {
    agent any 

    environment {
        GITHUB_TOKEN=credentials('github-token')
        GITHUB_USERNAME='panosvaritis'
        GITHUB_URL='ghcr.io'
        IMAGE_P1="${GITHUB_URL}/${GITHUB_USERNAME}"
    }

    parameters {
        booleanParam (name: 'DEBUG', defaultValue: false, description: 'Used to show info')
    }

        stages {
            
            stage ('Welcome message'){
                steps {
                    sh """
                    echo "Hello from jenkins server"
                    """
                }
            }
            stage ('Clean workspace'){
                steps {
                    cleanWs()
                }
            }
            stage ('Checkout the code'){
                steps {
                    checkout scm
                }
            }
            stage ('DEBUG'){
                steps {
                    script{
                        if (params.DEBUG){
                            echo "Git hub username: ${GITHUB_USERNAME}"
                            echo "Git hub url: ${GITHUB_URL}"
                            echo "Token is fetched!! Lenght ${GITHUB_TOKEN.length()}"
                            echo "Image name prefix: ${IMAGE_P1}"
                        }else {
                            echo "Nothing to show"
                        }
                    }
                }
            }
            stage ('Login to git hub'){
                steps {
                    sh """
                    cat \${GITHUB_TOKEN} | docker login ${GITHUB_URL} -u ${GITHUB_USERNAME} --password-stdin
                    """
                }
            }
            
        }
}